<!DOCTYPE html>
<html>

</head>

<body class="stackedit">
  <div class="stackedit__html"><h1><a id="Intel_RealSense_D435i_2"></a>一.姿态估计（使用的是Intel RealSense D435i深度相机）</h1>
<p>该功能的实现代码在 aruco _mark目录下的detect_aruco_dynamic_realsense_pub.py<br>
<img src="https://img-blog.csdnimg.cn/e2ea0018dc1d4d5ab8126737f33d0a98.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2htNzQ1NQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2><a id="1realsense__8"></a>1.realsense 的前期驱动和库的安装配置</h2>
<p>需要去安装官方的可视化界面和SDK,我基于的OS是unbuntu16.04，安装驱动和配置可能是漫长的解决报错的过程。注：必须要使用USB3.0以上的接口才能承受大数据流的传输。<br>
安装可参考：<em>https://github.com/IntelRealSense/librealsense/blob/master/doc/distribution_windows.md</em><br>
如果在终端输入<br>
<code>realsense-viewer</code><br>
SDK如果启动代表安装成功。如下图所示，是我打开了左侧按钮的所有输入流。<br>
<img src="https://img-blog.csdnimg.cn/d6c98fcb36244eb4ae1933a4119598a8.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2htNzQ1NQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2><a id="2realsensepythonpyrealsense2_17"></a>2.如果要调用realsense运行程序的话，python还需要安装pyrealsense2库。</h2>
<p>2.1 方便快捷的方法可以直接pip安装<br>
<code>pip install pyrealsense2</code><br>
2.2 intel官方还提供了source安装的步骤，如果之前安装过 librealsense库的话，在/librealsense/warpper/python/ 目录下。<br>
更新&amp;升级<br>
<code>sudo apt-get update &amp;&amp; sudo apt-get upgrade</code><br>
安装python3的开发文件<br>
<code>sudo apt-get install python3 python3-dev</code><br>
运行cmake</p>
<pre><code class="prism language-bash"><span class="token function">mkdir</span> build
<span class="token function">cd</span> build
cmake <span class="token punctuation">..</span>/ -DBUILD_PYTHON_BINDINGS<span class="token operator">=</span>bool:true
</code></pre>
<p>配置PYTHONPATH 环境路径<br>
<code>export PYTHONPATH=$PYTHONPATH:/usr/local/lib</code></p>
<p>2.3验证pyrealsense2是否成功</p>
<p>官网提供了样例可以测试，使用opencv显示深度和RGB图像。<br>
网址：<em>https://github.com/IntelRealSense/librealsense/blob/development/wrappers/python/examples/opencv_viewer_example.py</em></p>
<h2><a id="3_aruco_mask_45"></a>3. aruco_mask</h2>
<p>姿态估计的基础是找到现实世界和图像投影之间的对应点。<br>
使用aruco_mask来实现。 给定一个可以看见ArUco marker的图像，检测程序应当返回检测到的marker的列表。每个检测到的marker包括：<br>
3.1.图像四个角的位置（按照原始的顺序）2.marker的Id<br>
aruco_mask可以使用c++代码生成，或者通过https://chev.me/arucogen/ 直接生成。<br>
3.2.实现相机的Pose检测，首先需要知道相机的校准参数，即相机内参（mtx）和畸变系数(dist)，事先需要基于标定板做相机的标定，获取相机参数。我是用的相机参数在<em>aruco_mark/detect_aruco_dynamic_realsense_pub.py</em> 里的mtx和dist矩阵，需要利用这两个矩阵参数来实现pose检测。<br>
3.3 其中使用aruco.detectMarkers()函数可以检测到marker，输入为：灰度图，aruco标定板类型，aruco参数；输出ID和标志板的4个角点坐标。分别是corners，ids, rejectedImgPoints。</p>
<pre><code class="prism language-python">corners<span class="token punctuation">,</span> ids<span class="token punctuation">,</span> rejectedImgPoints <span class="token operator">=</span> aruco<span class="token punctuation">.</span>detectMarkers<span class="token punctuation">(</span>gray<span class="token punctuation">,</span>aruco_dict<span class="token punctuation">,</span>parameters<span class="token operator">=</span>parameters<span class="token punctuation">)</span>
</code></pre>
<p>因为realsense是放在机器人上的，所以还需要把相机坐标系转化为机器人坐标系。</p>
<pre><code class="prism language-python">data0<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos_z_mean  
data0<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>pos_x_mean
data0<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span>pos_y_mean
</code></pre>
<p>为了降低误差，采用均值滤波的方法，输出位姿x,y,z的均值。</p>
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">mean_filter</span><span class="token punctuation">(</span>pos_x_list<span class="token punctuation">,</span>pos_y_list<span class="token punctuation">,</span>pos_z_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num_pos <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pos_x_list<span class="token punctuation">)</span>
    pos_x_num <span class="token operator">=</span> <span class="token number">0</span>
    pos_y_num <span class="token operator">=</span> <span class="token number">0</span>
    pos_z_num <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pos_x_num <span class="token operator">=</span> pos_x_num <span class="token operator">+</span> pos_x_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        pos_y_num <span class="token operator">=</span> pos_y_num <span class="token operator">+</span> pos_y_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        pos_z_num <span class="token operator">=</span> pos_z_num <span class="token operator">+</span> pos_z_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    pos_x_mean <span class="token operator">=</span> pos_x_num<span class="token operator">/</span>num_pos
    pos_y_mean <span class="token operator">=</span> pos_y_num <span class="token operator">/</span> num_pos
    pos_z_mean <span class="token operator">=</span> pos_z_num <span class="token operator">/</span> num_pos
    <span class="token keyword">return</span> pos_x_mean<span class="token punctuation">,</span>pos_y_mean<span class="token punctuation">,</span>pos_z_mean
</code></pre>
<p>主函数还包括 socket通信模块（其中涉及了与c++通信，是使用struct模块，通过pack将某些特定的结构体类型打包成二进制流的字符串然后再网络传输），显示模块等。使用realsense相机测试我笔记本上生成的aruco_mask效果如下，坐标系统处在marker重心，Z坐标指向mark外部，坐标的颜色为,X:红色，Y：绿色，Z：蓝色。id是在左上角显示。第二张是我手持打印的aruco_mask效果。<br>
<img src="https://img-blog.csdnimg.cn/20210618101609707.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2htNzQ1NQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"><img src="https://img-blog.csdnimg.cn/3e53191269cc4a268d99f3dc7b935b04.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2htNzQ1NQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h1><a id="TX2_83"></a>二、基于展品的目标检测(在TX2实现)</h1>
<p>demo：<a href="https://www.bilibili.com/video/BV1Z54y1G7eg/">Video link</a><br>
由于检测最终要求在Xavier上运行的，之前用在实验室的TX2配置了tensorflow，所以使用是yolov3的tensorflow的复现版本。<br>
<strong>reference</strong>:<em>https://github.com/YunYang1994/tensorflow-yolov3</em><br>
使用labelimg 制作数据集，包括训练集，测试集，验证集，可搜索学习怎么使用labelimg制作适用于yolo的数据集。</p>
<h2><a id="_90"></a>绘制中心线</h2>
<p>网络训练（训练环境是cuda10.0）的到相应的权重，使用权重对场景进行预测。一帧的结果图如下。<br>
图中的红线是我用opencv根据图片尺寸（1920*1080）画的中心点交线，为了直观的显示中间点。为后面计算展品据中心偏移量做准备。我是根据读代码，找到了原作者在utils/plot_utils.py下，绘制bounding_box的代码区，使用cv2.line()函数绘制了红线。</p>
<pre><code class="prism language-python"><span class="token keyword">if</span> label<span class="token punctuation">:</span>
        tf <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>tl <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># font thickness</span>
        t_size <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getTextSize<span class="token punctuation">(</span>label<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> fontScale<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">(</span>tl<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span>tf<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        c2 <span class="token operator">=</span> c1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> t_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> t_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">3</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> color<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># filled</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img<span class="token punctuation">,</span> label<span class="token punctuation">,</span> <span class="token punctuation">(</span>c1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span>tl<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span>tf<span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
        ptStart <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">960</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        ptEnd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">960</span><span class="token punctuation">,</span> <span class="token number">1080</span><span class="token punctuation">)</span>
        point_color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token comment"># BGR</span>
        thickness <span class="token operator">=</span> <span class="token number">1</span>
        lineType <span class="token operator">=</span> <span class="token number">8</span>
        cv2<span class="token punctuation">.</span>line<span class="token punctuation">(</span>img<span class="token punctuation">,</span> ptStart<span class="token punctuation">,</span> ptEnd<span class="token punctuation">,</span> point_color<span class="token punctuation">,</span> thickness<span class="token punctuation">,</span> lineType<span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>line<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">540</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1920</span><span class="token punctuation">,</span><span class="token number">540</span><span class="token punctuation">)</span><span class="token punctuation">,</span> point_color<span class="token punctuation">,</span> thickness<span class="token punctuation">,</span> lineType<span class="token punctuation">)</span>
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/d56a5a1c53644cc0b06f78f64fe767d1.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2htNzQ1NQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2><a id="_113"></a>视频检测</h2>
<p>基于test_single_image.py，原作者是对单张图片的检测，我使用opencv的 cv2.VideoCapture读取视频，cv2.VideoCapture不仅可以读取本地视频还可以基于rtsp读取网络摄像头的输入流（功能强大）。<br>
使用while 循环不断地读取图片帧并输入yolov3网络处理，网络输出的预测图片以视频流的形式显示。</p>
<h2><a id="_117"></a>计算中心点的偏移距离</h2>
<p>根据相机偏离重心的距离，输出控制机器人的运动，主要目的是机器人识别出距离中心点最近的展品，并进行后续的操作（靠近，讲解等），把x,y方向的偏移距离显示在视频的左上方。<br>
<img src="https://img-blog.csdnimg.cn/1ebdad2d836a4b42b76df2b1f0483fab.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2htNzQ1NQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<pre><code class="prism language-python"><span class="token keyword">if</span> object_center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">960</span> <span class="token operator">and</span> object_center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">540</span><span class="token punctuation">:</span>
            x_offset <span class="token operator">=</span> object_center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">960</span>
            y_offset <span class="token operator">=</span> object_center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">540</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'横向偏差：'</span><span class="token punctuation">,</span> x_offset<span class="token punctuation">,</span> <span class="token string">'纵向偏差'</span><span class="token punctuation">,</span> y_offset<span class="token punctuation">,</span> <span class="token string">'镜头偏左上 请右下移动'</span><span class="token punctuation">)</span>
            img_ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img_ori<span class="token punctuation">,</span> <span class="token string">'x_offset:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            img_ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img_ori<span class="token punctuation">,</span> <span class="token string">'y_offset:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>y_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> object_center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">960</span> <span class="token operator">and</span> object_center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token number">540</span><span class="token punctuation">:</span>
            x_offset <span class="token operator">=</span> <span class="token number">960</span> <span class="token operator">-</span> object_center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            y_offset <span class="token operator">=</span> <span class="token number">540</span> <span class="token operator">-</span> object_center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'横向偏差：'</span><span class="token punctuation">,</span> x_offset<span class="token punctuation">,</span> <span class="token string">'纵向偏差'</span><span class="token punctuation">,</span> y_offset<span class="token punctuation">,</span> <span class="token string">'镜头偏右下 请左上移动'</span><span class="token punctuation">)</span>
            img_ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img_ori<span class="token punctuation">,</span> <span class="token string">'x_offset:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            img_ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img_ori<span class="token punctuation">,</span> <span class="token string">'y_offset:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>y_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> object_center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span><span class="token number">960</span> <span class="token operator">and</span> object_center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">540</span><span class="token punctuation">:</span>
            x_offset <span class="token operator">=</span> object_center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">960</span>
            y_offset <span class="token operator">=</span> <span class="token number">540</span> <span class="token operator">-</span> object_center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'横向偏差：'</span><span class="token punctuation">,</span> x_offset<span class="token punctuation">,</span> <span class="token string">'纵向偏差'</span><span class="token punctuation">,</span> y_offset<span class="token punctuation">,</span> <span class="token string">'镜头偏左下 请右上移动'</span><span class="token punctuation">)</span>
            img_ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img_ori<span class="token punctuation">,</span> <span class="token string">'x_offset:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            img_ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img_ori<span class="token punctuation">,</span> <span class="token string">'y_offset:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>y_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> object_center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">960</span> <span class="token operator">and</span> object_center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">540</span><span class="token punctuation">:</span>
            x_offset <span class="token operator">=</span> <span class="token number">960</span> <span class="token operator">-</span> object_center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            y_offset <span class="token operator">=</span> object_center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">540</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'横向偏差：'</span><span class="token punctuation">,</span> x_offset<span class="token punctuation">,</span> <span class="token string">'纵向偏差'</span><span class="token punctuation">,</span> y_offset<span class="token punctuation">,</span> <span class="token string">'镜头偏右上 请左下移动'</span><span class="token punctuation">)</span>
            img_ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img_ori<span class="token punctuation">,</span> <span class="token string">'x_offset:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>x_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            img_ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img_ori<span class="token punctuation">,</span> <span class="token string">'y_offset:'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>y_offset<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'镜头已经正向'</span><span class="token punctuation">)</span>
            img_ori <span class="token operator">=</span> cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img_ori<span class="token punctuation">,</span> <span class="token string">'Sucessful!'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_COMPLEX<span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span>classes<span class="token punctuation">)</span>
</code></pre>
</div>
</body>

</html>
